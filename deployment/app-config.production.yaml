# Backstage Production Configuration for MCP Tools Catalog
# 
# This file is applied as a ConfigMap and mounted into the Backstage pod.
# Environment variables (${VAR}) are substituted at runtime.
#
# Required environment variables:
#   - GITHUB_TOKEN: GitHub Personal Access Token for authentication
#   - GITHUB_ORG: GitHub organization or user name
#   - GITHUB_REPO: Repository containing catalog YAML files
#   - GITHUB_BRANCH: Branch to read from (default: main)

# GitHub Integration (required for private repositories)
integrations:
  github:
    - host: github.com
      token: ${GITHUB_TOKEN}

# Catalog Configuration
catalog:
  # Import cycle frequency
  processingInterval: { minutes: 5 }
  
  # Locations to import entities from
  locations:
    # MCP Tools Catalog entities from GitHub (main branch)
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/github-server.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/github-tools.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/kubernetes-server.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/kubernetes-tools.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/test1-server.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/test1-tools.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/test1-workload.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/multi-server-workloads.yaml
      rules:
        - allow: [Component]
    - type: url
      target: https://raw.githubusercontent.com/JoshSalomon/mcp-tools-catalog/main/entities/sample-guardrails.yaml
      rules:
        - allow: [Component]

  # Orphan cleanup strategy (removes entities when deleted from GitHub)
  orphanStrategy: delete

# Backend Configuration
backend:
  # SECURITY WARNING: This disables authentication for development/testing.
  # Remove this in production and configure proper authentication.
  # See DEPLOYMENT.md "TODO: Authentication Support" section.
  auth:
    dangerouslyDisableDefaultAuthPolicy: true
  
  # Allow reading from GitHub raw content URLs
  reading:
    allow:
      - host: raw.githubusercontent.com

  # Database configuration for SQLite (PoC)
  # For production, switch to PostgreSQL - see backstage-deployment.yaml
  # IMPORTANT: Use 'directory' (not ':memory:') to persist data across pod restarts.
  # The directory must match the persistent volume mount path in backstage-deployment-sqlite.yaml
  database:
    client: better-sqlite3
    connection:
      directory: /app/sqlite-data  # Persistent volume mount - data survives pod restarts

  plugins:
    catalog:
      processors:
        mcp:
          enabled: true

# MCP Catalog Plugin Configuration
mcpCatalog:
  enabled: true
  processing:
    batchSize: 100
    validationInterval: 30
  ui:
    showRelationshipGraphs: true
    maxEntitiesPerPage: 50
  integrations:
    openshift:
      enabled: true
      baseUrl: ${OPENSHIFT_API_URL}
      namespace: mcp-tools-catalog
